#include<pthread.h>

//template <class _KEY , class _DATA>
class ConcurrentHopscotchHashSet {
private:
	static const int HOP_RANGE = 32;
	static const int ADD_RANGE = 256;
 	static const int MAX_SEGMENTS = 1024;
	static const int MAX_TRIES = 2;
	struct Bucket {
		Bucket(){
			_hop_info = 0;
			_lock = 0;
			_key = NULL;
			_timestamp = 0;
			pthread_mutex_init(&lock_mutex,NULL);
			pthread_cond_init (&lock_cv, NULL);
  		}
		unsigned int volatile _hop_info;
		//_KEY* volatile _key;
		//_DATA* volatile _data;
		int* volatile _key;
		int* volatile _data;
		unsigned int volatile _lock; 
		unsigned int volatile _timestamp;
		pthread_mutex_t lock_mutex;
		pthread_cond_t lock_cv;	
		void lock();
		void unlock();
		};
	Bucket* segments_ary[MAX_SEGMENTS];
public:
//	ConcurrentHopscotchHashSet();
//	bool contains(_KEY* key);
//	_DATA* add(_KEY* key, _DATA* data);
//	_DATA* remove(_KEY* key);
	bool contains(int* key);
	int* add(int* key, int* data);
	int* remove(int* key);
};
